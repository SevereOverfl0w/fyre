#!/bin/sh
#
# File            : /home/wildefyr/fyre/yawee
# Maintainer      : Wildefyr | http://wildefyr.net
# Copyright       : Wildefyr | Licensed under the WTFPL license.
# Depends on      : wew; wmutils
# Original Author : z3bra
# Description     : Read window events and execute processes.

source fyrerc

while IFS=: read ev wid; do
    case $ev in
        # entering window
        7)
            wattr o $wid || focus $wid
            ;;
        # window creation
        16)
            if ! wattr o $wid; then
                if [ $windowsOnscreen -gt 4 ]; then
                    position br $wid
                else
                    position norm $wid
                fi
                if [ ! -e $FULLSCRN ]; then tile; fi
            fi
            ;;
        # window unmap
        18)
            if ! wattr o $wid; then
                focus prev 2>/dev/null
                # Tile only on window deletion and not window unfocus (i.e. groups)
                for i in $(seq $(lsw -u | wc -l)); do
                    current=$(lsw -u | head -n $i | tail -1)
                    if [[ $wid == $current ]]; then
                        # Add exceptions here.
                        if [[ $(wclass c $wid) == "urxvtc" ]]; then
                            tileFlag=0
                            break
                        fi
                        tileFlag=1
                        break
                    else
                        tileFlag=0
                    fi
                done
                if [ $tileFlag -eq 0 ]; then
                    tile
                fi
            fi
            ;;
        # mapping requests
        19)
            wattr o $wid && chwb -s 1 -c 0x000000 $wid || focus $wid
            ;;
    esac
done
